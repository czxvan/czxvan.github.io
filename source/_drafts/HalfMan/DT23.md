---
title: DT23
date: 2023-11-08 09:12:13
tags:
categories: HalfMan
---

DT23软件平台代码分析（文档）。

注：本篇笔记不公开。

<!-- more -->

## 目录结构

使用 tree -a . 命令，列出目录结构

```shell
.
├── .DS_Store
├── .git 
├── .gitignore
├── .idea
├── .vscode
├── README.md
├── logs	# 日志目录
├── requirements.txt # python 依赖， 由pipreqs . --encoding=utf-8 --froce 生成
```

### 资源目录

```shell
├── resources
│   ├── icons(目录)	# 存放图片
│   └── qss
│       └── style.py # 界面风格设置
```

### store目录

```shell
├── store
│   ├── ml_storex.py	# 初始化并管理全局字典ml_dict - 用于机器学习模块，init setValue getValue setPara deleteKey
│   ├── model.py		# 初始化并管理全局字典store_model - 用于存放深度学习模型数据，init setValue getValue
│   ├── property.py		# 初始化并管理全局字典store_property - 存储选中层的属性, 初始为空 - init setValue getValue
│   └── storex.py		# 初始化并管理全局字典store_model - 通用，init setValue getValue deleteKey
```

#### ml_storex - ml_dict 

> 存储机器学习默认参数

```python
ml_dict = {
	"task_type":"REG",
    "method":"线性回归"，
    "parameters":{
        '线性回归': {'fit_intercept': True,...},
        'Ridge回归': {...},
        '多项式回归': {...},
        'Lasso回归': {...},
        'ElasticNet回归': {...},
        '逻辑回归分类': {...},
        '朴素贝叶斯分类': {...},
        '最近邻分类': {...},
        '支持向量机分类': {...},
        '决策树分类': {...},
        '随机森林分类': {...},
        'K均值聚类': {...},
        '层次聚类': {...},
        '高斯混合聚类': {...},
        'DBSCAN聚类': {...},
    }
    "train_data": [],
    "train_label": [],
    "test_data": [],
    "test_label": [],
}
```

#### model - stroe_model

> 存储模型属性，暂时还没用呢

```python
stroe_model = {
        # key为DataView中Tab的num
        # value为Dataflow各项信息
        1: {
            # 模型结构，包含每一层的uuid
            "model_layer_list": [],
            # 模型的超参
            "hyperparameters": {
                'epochNumber': '',
                'batchSize': '',
                'learningRate': '',
                'optimizer': '',
                'lossFunction': '',
            },
            # 深度学习数据和标签
            "train_data": [],
            "train_label": [],
            "test_data": [],
            "test_label": []
        }
    }
```

#### property - store_property

> from store import property as store_property

```
存储每一层的属性（x)
存储当前选中层的属性（√，也有一点问题，已修复）
{'in_features': '12', 'out_features': '20', 'bias': 'False', 'inplace': 'True'}
{'in_features': '1', 'out_features': '', 'bias': 'False', 'inplace': 'True'}
{'in_features': '12', 'out_features': '20', 'bias': 'False', 'inplace': 'True'}
{'in_features': '1', 'out_features': '', 'bias': 'False', 'inplace': 'True'}
{'in_features': '1', 'out_features': '', 'bias': 'False', 'inplace': 'True'}
```

#### storex - global_dict

```python
global_dict = {
        "files_selected": [],
        "container_widget": None,
        "selected_layer": None,
        "current_dataflow": -1,
        "model_layer_list": [],
        "hyperparameters": {},
        # data input
        "train_data": [],
        "train_label": [],
        "test_data": [],
        "test_label": [],
    }
```

### model_config目录

```shell
├── model_config
│   └── model1.txt	# 存储模型每一层及其连接的信息，以及训练时采用的超参数
```

model1.txt - Liner Relu Liner Relu Liner 

```shell
[hyperparameters]
epochNumber=100
batchSize=4
learningRate=0.001
optimizer=SGD
lossFunction=MSELoss

[linear]
uuid=dbe2f6a7c1a34c0d9dbccb92480eddea
in_list=[]
out_list=[9ad08d18dc0a4034b3528462424e3aa7]
in_features=4
out_features=32
bias=False

[Relu]
uuid=9ad08d18dc0a4034b3528462424e3aa7
in_list=[dbe2f6a7c1a34c0d9dbccb92480eddea]
out_list=[f0b24616bbb044709cf77be759889be6]
inplace=True

[linear]
uuid=f0b24616bbb044709cf77be759889be6
in_list=[9ad08d18dc0a4034b3528462424e3aa7]
out_list=[2ada9ee9642c4f6ea98b362cfec770f7]
in_features=32
out_features=64
bias=False

[Relu]
uuid=2ada9ee9642c4f6ea98b362cfec770f7
in_list=[f0b24616bbb044709cf77be759889be6]
out_list=[18ce6ef769534543b4630812652f4b10]
inplace=True

[linear]
uuid=18ce6ef769534543b4630812652f4b10
in_list=[2ada9ee9642c4f6ea98b362cfec770f7]
out_list=[]
in_features=64
out_features=3
bias=False
```

### models目录

```shell
├── models
│   ├── clustering		# 聚类
│   │   ├── hierarchical.py	# 层次聚类, hierarchicalClustering(data)->Z
│   │   └── k_means.py # k均值聚类，loadDataSet(fileName:”.txt")  KMeans(dataSet, k)
│   ├── hash_sim		# 使用局部敏感哈希模型，评估数据之间的相似程度simi
│   │   ├── LSH.pt		# 局部敏感哈希模型，LSHModel(Locality Sensitive Hashing Model)
│   │   ├── eval.py		# 训练: hash_train  使用：hash_sim
│   │   ├── model.py	# 定义LSHModel
│   │   └── train.py	# 训练demo
│   ├── discover.py		# data_preprocessing() calculate_simi() part_simi_modeling()
│   ├── interval.py		# 数据分割 unequal_div() interval_splitting()
│   └── wave_sim.py		# waveform_similarity()
```

### utils目录

```
├── utils
│   ├── machine_learning
│   │   └── model.py
│   ├── deep_learning
│   │   ├── model.py
│   │   ├── model_new.py
│   │   └── train.py
│   ├── static
│   │   ├── data_view_start.py
│   │   └── menu_static.py
│   ├── checkable_file_model.py		# checkable文件系统模型
│   ├── data_view_table_widget.py	# 自定义的表格控件
│   ├── file_selection_buttons.py 	# 功能按钮：选择文件
│   ├── graph_draw.py				# 绘图功能
│   ├── logger.py					# 日志功能
│   ├── sub_result_widget.py		# 结果输出子控件
│   └── util.py						# 功能函数：读取文件readFile（第一行是标签），列表转表格listToTableWidget
```

### main.py

整个界面是主窗口装着一个menu_widget+一个container_widget

```python
import sys

from PyQt5.QtCore import Qt
from PyQt5.QtWidgets import QApplication, QWidget, QDesktopWidget, QVBoxLayout
from PyQt5.QtGui import QIcon, QFont
from views.menu import MenuWidget
from views.container import ContainerWidget
from resources.qss.style import STYLE_SHEET_MAIN
from store import model as store_model, storex, ml_storex
from store import property as store_property


class MainWindow(QWidget):
    def __init__(self):
        # 初始化四个全局字典
        storex.init()
        ml_storex.init()
        store_model.init()
        store_property.init()
        
        super().__init__()
        self.menu_widget = MenuWidget()	# menu组件
        self.container_widget = ContainerWidget()	# 容器组件
        storex.setValue('container_widget', self.container_widget)
        self.initUI()

    def initUI(self):
        layout = QVBoxLayout()
        layout.addWidget(self.menu_widget)	# 就这俩子控件
        layout.addWidget(self.container_widget)
		...

if __name__ == '__main__':
    ...
```

### views目录

#### 容器栏

```shell
└── views
    ├── container.py # 包含五个窗口：工作空间、文件数据展示
    ├── workspace.py # 工作空间，文件目录浏览
    ├── data_view.py # 各种文件内容展示
    ├── dataflow	 # 打开的每个文件对应一个dataflow
    │   ├── edge.py
    │   ├── item.py
    │   ├── scene.py
    │   └── view.py
    ├── layer_library.py
    ├── property.py
    ├── result_display.py
    ├── dialog # 各类对话框
    ├── form
    │   ├── feature_select.py
    │   └── parameters.py
    
```

ContainerWidget

```python
class ContainerWidget(QWidget):
    def __init__(self):
        super().__init__()
        self.workspace_widget = WorkspaceWidget()	# 工作空间-目录文件展示
        self.data_view_widget = DataViewWidget()	# 数据展示
        self.result_display_widget = ResultDisplayWidget()	# 结果展示
        self.layer_library = LayerLibraryWidget()	# 层库
        self.property_widget = PropertyWidget()		# 配置窗口
        self.file_button = QPushButton('\n\n文\n\n件\n\n')
        self.result_button = QPushButton('\n\n结\n\n果\n\n')
        self.layer_button = QPushButton('\n\n组\n\n件\n\n')
        self.property_button = QPushButton('\n配\n置\n信\n息\n')
        self.initUI()
```

#### 菜单栏

```python
└── views
    ├── menu.py			# 菜单界面
    ├── menu_tab
    │   ├── tab_1.py	# 开始
    │   ├── tab_2.py	# 统计分析
    │   ├── tab_3.py	# 机器学习
    │   ├── tab_4.py	# 深度学习
    │   └── tab_5.py	# 帮助
```

##### 深度学习tab_4

```python
def onConnectButtonClicked(self):
        self.parent().parent().parent().container_widget.data_view_widget.addDataflowView()

# data_view.py
def addDataflowView(self):
    ...
    content = self.assembleDataflowContent()
    ...
    
def assembleDataflowContent(self):
    content = DataflowView()
   ...
    return content

# dataflow/view.py

```

